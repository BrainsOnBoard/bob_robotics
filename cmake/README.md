## CMake utilities
This folder contains the common CMake code shared between projects. The main
file is ``bob_robotics.cmake`` which is used to build BoB modules (which can be
found in [src/](../src)).

To make a new BoB robotics project you need to create a ``CMakeLists.txt`` file
with the following lines at the top:
```cmake
cmake_minimum_required(VERSION 3.1)
include([path to BoB robotics]/cmake/bob_robotics.cmake)
```

If you have the ``BOB_ROBOTICS_PATH`` environment variable set, you can do this:
```cmake
cmake_minimum_required(VERSION 3.1)
include($ENV{BOB_ROBOTICS_PATH}/cmake/bob_robotics.cmake)
```

Next, we call the ``BoB_project()`` function to specify which modules,
third-party libraries and external libraries we are using. All of these
parameters are optional.
```cmake
BoB_project(SOURCES my_program.cc
            BOB_MODULES common hid antworld video
            THIRD_PARTY third_party_modules
            EXTERNAL_LIBS sdl2)
```
As a rule of thumb, if you ``#include`` a file from a given folder, then the folder name is the module you should include (i.e. if you
include [imgproc/opencv_unwrap_360.h](../include/imgproc/opencv_unwrap_360.h),
you need to add ``imgproc`` to your ``BOB_MODULES``). Some modules depend on
others and on external libraries, but these dependencies should be handled
automatically. Generally you *don't* need to specify ``EXTERNAL_LIBS``
explicitly as these dependencies will already be added.

Every subfolder in [third_party/](../third_party) counts as a ``THIRD_PARTY``
module and you can include it by adding it to the ``THIRD_PARTY`` list.
[plog](https://github.com/SergiusTheBest/plog) is included automatically.
Header-only files do not need to be added to the ``THIRD_PARTY`` array, with the
exception of [matplotlibcpp](../third_party/matplotlibcpp.h), which has external
dependencies.

If a project will only work on a particular platform, then you should specify
possible platforms in the ``PLATFORMS`` array. Possible options are ``unix``,
``linux``, ``windows`` and ``all``. The default is ``all``.

Note that by default, ``BoB_project()`` builds every file in ``SOURCES`` array
as a separate executable. If you want to make a single executable from multiple
``*.cc`` files instead, specify a name for the executable, like so:
```cmake
BoB_project(EXECUTABLE my_program
            SOURCES my_program.cc common.cc
            ...
            )
```

## GeNN support
[GeNN](https://github.com/genn-team/genn) support for a project can be added
like so:
```cmake
BoB_project(BOB_MODULES ${BOB_MODULES}
            GENN_MODEL model.cc
            GENN_CPU_ONLY)
```
The ``GENN_CPU_ONLY`` parameter is optional.

## Disabling I2C support
As you may not want to build the I2C code (i.e. on a desktop machine), you can
set the ``NO_I2C`` environment variable so this code will not be included in the
``common`` module.

## Building projects
To build a project with CMake, use the standard procedure:
```sh
mkdir build
cd build
cmake ..
make -j $(nproc)
```
As typing this can become tedious, there is a script called ``bob_make`` in
[bin/](../bin) which performs these steps. You can add this folder to your
``$PATH`` for convenience.

## Windows support
For Windows, we use [Microsoft's vcpkg](https://github.com/Microsoft/vcpkg) for
dependencies. To use with BoB robotics, install vcpkg following the instructions
[here](https://github.com/Microsoft/vcpkg/blob/master/README.md). As vcpkg
[installs 32-bit packages by default](https://github.com/Microsoft/vcpkg/issues/1254),
we recommend that you set the environment variable ``VCPKG_DEFAULT_TRIPLET`` to
``x64-windows`` to get 64-bit builds. You also need to set the environment
variable ``VCPKG_ROOT`` to wherever you have installed vcpkg, so that the BoB
robotics CMake file can find your installed packages.

You can then install any needed packages like so:
```bat
.\vcpkg.exe install opencv
```

Note that CMake *also* defaults to building 32-bit binaries on Windows; if you
want a 64-bit build you have to enable it explicitly:
```bat
cmake.exe -DCMAKE_GENERATOR_PLATFORM=x64 ..
```

You may need to set your build type in Visual Studio to ``Release`` as sometimes
debug versions of DLLs appear not to be generated by vcpkg.
